<!DOCTYPE html><html lang="pt-BR"><head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>AgendarMedição - Sistema de Agendamentos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet"/>
    <style>
        :root {
            --purple-primary: #8B5CF6;
            --purple-dark: #7C3AED;
            --purple-light: #A78BFA;
        }
        .custom-purple { background-color: var(--purple-primary); }
        .custom-purple-dark { background-color: var(--purple-dark); }
        .custom-purple-light { background-color: var(--purple-light); }
        .text-custom-purple { color: var(--purple-primary); }
        .border-custom-purple { border-color: var(--purple-primary); }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .glass-effect {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.95);
        }
        
        .hover-scale {
            transition: transform 0.2s ease;
        }
        
        .hover-scale:hover {
            transform: scale(1.02);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-50 to-purple-50 min-h-screen">
    <!-- Navigation -->
    <nav class="bg-white shadow-lg border-b-4 border-purple-500">
        <div class="container mx-auto px-4">
            <div class="flex justify-between items-center py-4">
                <!-- Logo -->
                <div class="flex items-center space-x-2">
                    <i class="fas fa-ruler-combined text-xl sm:text-2xl text-custom-purple"></i>
                    <h1 class="text-lg sm:text-2xl font-bold text-gray-800">AgendarMedição</h1>
                </div>
                
                <!-- Desktop Navigation -->
                <div class="hidden md:flex space-x-2 lg:space-x-4">
                    <button onclick="showSection(form)" class="nav-btn px-3 lg:px-4 py-2 rounded-lg bg-purple-500 text-white hover:bg-purple-600 transition-colors text-sm lg:text-base">
                        <i class="fas fa-plus mr-1 lg:mr-2"></i>
                        <span class="hidden lg:inline">Novo </span>Agendamento
                    </button>
                    <button onclick="showSection(dashboard)" class="nav-btn px-3 lg:px-4 py-2 rounded-lg bg-gray-600 text-white hover:bg-gray-700 transition-colors text-sm lg:text-base">
                        <i class="fas fa-chart-dashboard mr-1 lg:mr-2"></i>Dashboard
                    </button>
                    <button onclick="showSection(list)" class="nav-btn px-3 lg:px-4 py-2 rounded-lg bg-black text-white hover:bg-gray-800 transition-colors text-sm lg:text-base">
                        <i class="fas fa-list mr-1 lg:mr-2"></i>Agendamentos
                    </button>
                </div>
                
                <!-- Mobile Menu Button -->
                <button onclick="toggleMobileMenu()" class="md:hidden p-2 text-gray-600 hover:text-purple-600 focus:outline-none">
                    <i class="fas fa-bars text-xl" id="mobile-menu-icon"></i>
                </button>
            </div>
            
            <!-- Mobile Navigation Menu -->
            <div id="mobile-menu" class="hidden md:hidden pb-4">
                <div class="flex flex-col space-y-2">
                    <button onclick="showSection(form); toggleMobileMenu()" class="nav-btn px-4 py-3 rounded-lg bg-purple-500 text-white hover:bg-purple-600 transition-colors text-left">
                        <i class="fas fa-plus mr-2"></i>Novo Agendamento
                    </button>
                    <button onclick="showSection(dashboard); toggleMobileMenu()" class="nav-btn px-4 py-3 rounded-lg bg-gray-600 text-white hover:bg-gray-700 transition-colors text-left">
                        <i class="fas fa-chart-dashboard mr-2"></i>Dashboard
                    </button>
                    <button onclick="showSection(list); toggleMobileMenu()" class="nav-btn px-4 py-3 rounded-lg bg-black text-white hover:bg-gray-800 transition-colors text-left">
                        <i class="fas fa-list mr-2"></i>Agendamentos
                    </button>
                </div>
            </div>
        </div>
    </nav>
<div class="container mx-auto px-2 sm:px-4 py-4 sm:py-8"><!-- Formulário de Agendamento -->
        <section id="form-section" class="section fade-in">
            <div class="bg-white rounded-xl sm:rounded-2xl shadow-xl p-4 sm:p-6 lg:p-8 glass-effect hover-scale">
                <h2 class="text-xl sm:text-2xl lg:text-3xl font-bold text-gray-800 mb-6 sm:mb-8 text-center">
                    <i class="fas fa-calendar-plus text-custom-purple mr-2 sm:mr-3"></i>
                    <span class="block sm:inline">Novo Agendamento de Medição</span>
                </h2>
                
                <form id="agendamento-form" class="space-y-6"><div class="grid grid-cols-1 sm:grid-cols-2 gap-4 sm:gap-6"><!-- Nome Cliente -->
                        <div class="sm:col-span-2 md:col-span-1">
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-user mr-2 text-custom-purple"></i>Nome do Cliente*
                            </label>
                            <input type="text" id="nome-cliente" required="" class="w-full px-3 sm:px-4 py-2 sm:py-3 text-sm sm:text-base border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:ring focus:ring-purple-200 transition-all"/>
                        </div>
<!-- Telefone -->
                        <div class="sm:col-span-2 md:col-span-1">
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-phone mr-2 text-custom-purple"></i>Telefone*
                            </label>
                            <input type="tel" id="telefone" required="" placeholder="(11) 99999-9999" class="w-full px-3 sm:px-4 py-2 sm:py-3 text-sm sm:text-base border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:ring focus:ring-purple-200 transition-all"/>
                        </div>
<!-- E-mail -->
                        <div class="sm:col-span-2 md:col-span-1">
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-envelope mr-2 text-custom-purple"></i>E-mail*
                            </label>
                            <input type="email" id="email" required="" placeholder="exemplo@email.com" class="w-full px-3 sm:px-4 py-2 sm:py-3 text-sm sm:text-base border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:ring focus:ring-purple-200 transition-all"/>
                        </div>
<!-- Tipo de Imóvel -->
                        <div class="sm:col-span-2 md:col-span-1">
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-building mr-2 text-custom-purple"></i>Tipo de Imóvel*
                            </label>
                            <select id="tipo-imovel" required="" onchange="updateAmbientes()" class="w-full px-3 sm:px-4 py-2 sm:py-3 text-sm sm:text-base border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:ring focus:ring-purple-200 transition-all">
                                <option value="">Selecione o tipo</option>
                                <option value="casa">Casa</option>
                                <option value="apartamento">Apartamento</option>
                            </select>
                        </div>
<!-- Ambiente -->
                        <div class="sm:col-span-2 md:col-span-1">
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-home mr-2 text-custom-purple"></i>Ambiente*
                            </label>
                            <select id="ambiente" required="" class="w-full px-3 sm:px-4 py-2 sm:py-3 text-sm sm:text-base border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:ring focus:ring-purple-200 transition-all">
                                <option value="">Primeiro selecione o tipo de imóvel</option>
                            </select>
                        </div>
<!-- Loja -->
                        <div class="sm:col-span-2 md:col-span-1">
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-store mr-2 text-custom-purple"></i>Loja*
                            </label>
                            <select id="loja" required="" class="w-full px-3 sm:px-4 py-2 sm:py-3 text-sm sm:text-base border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:ring focus:ring-purple-200 transition-all">
                                <option value="">Selecione a loja</option>
                                <option value="Diana D1">Diana D1</option>
                                <option value="Diana D2">Diana D2</option>
                                <option value="Diana D3">Diana D3</option>
                                <option value="Diana D4">Diana D4</option>
                                <option value="Marquise Planejados">Marquise Planejados</option>
                                <option value="By Estilo">By Estilo</option>
                                <option value="Anfelle">Anfelle</option>
                                <option value="Planejados">Planejados</option>
                                <option value="Rassul Planejados">Rassul Planejados</option>
                                <option value="Miralli Móveis">Miralli Móveis</option>
                                <option value="Outros">Outros</option>
                            </select>
                        </div>
<!-- Data -->
                        <div class="sm:col-span-1">
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-calendar mr-2 text-custom-purple"></i>Data*
                            </label>
                            <input type="date" id="data" required="" class="w-full px-3 sm:px-4 py-2 sm:py-3 text-sm sm:text-base border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:ring focus:ring-purple-200 transition-all"/>
                        </div>
<!-- Horário -->
                        <div class="sm:col-span-1">
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-clock mr-2 text-custom-purple"></i>Horário*
                            </label>
                            <input type="time" id="horario" required="" class="w-full px-3 sm:px-4 py-2 sm:py-3 text-sm sm:text-base border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:ring focus:ring-purple-200 transition-all"/>
                        </div>
                    </div>
<!-- CEP e Endereço -->
                    <div class="space-y-4">
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                            <div class="sm:col-span-1">
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    <i class="fas fa-map-pin mr-2 text-custom-purple"></i>CEP*
                                </label>
                                <input type="text" id="cep" required="" placeholder="00000-000" onblur="buscarEndereco()" class="w-full px-3 sm:px-4 py-2 sm:py-3 text-sm sm:text-base border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:ring focus:ring-purple-200 transition-all"/>
                            </div>
                            <div class="sm:col-span-1 lg:col-span-1">
                                <label class="block text-sm font-medium text-gray-700 mb-2">Número*</label>
                                <input type="text" id="numero" required="" placeholder="123" class="w-full px-3 sm:px-4 py-2 sm:py-3 text-sm sm:text-base border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:ring focus:ring-purple-200 transition-all"/>
                            </div>
                            <div class="sm:col-span-2 lg:col-span-1">
                                <label class="block text-sm font-medium text-gray-700 mb-2">Complemento</label>
                                <input type="text" id="complemento" placeholder="Apto 45, Bloco B" class="w-full px-3 sm:px-4 py-2 sm:py-3 text-sm sm:text-base border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:ring focus:ring-purple-200 transition-all"/>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 sm:grid-cols-1 lg:grid-cols-3 gap-4">
                            <div class="lg:col-span-1">
                                <label class="block text-sm font-medium text-gray-700 mb-2">Logradouro*</label>
                                <input type="text" id="logradouro" required="" readonly="" class="w-full px-3 sm:px-4 py-2 sm:py-3 text-sm sm:text-base border-2 border-gray-200 rounded-lg bg-gray-50"/>
                            </div>
                            <div class="lg:col-span-1">
                                <label class="block text-sm font-medium text-gray-700 mb-2">Bairro*</label>
                                <input type="text" id="bairro" required="" readonly="" class="w-full px-3 sm:px-4 py-2 sm:py-3 text-sm sm:text-base border-2 border-gray-200 rounded-lg bg-gray-50"/>
                            </div>
                            <div class="lg:col-span-1">
                                <label class="block text-sm font-medium text-gray-700 mb-2">Cidade*</label>
                                <input type="text" id="cidade" required="" readonly="" class="w-full px-3 sm:px-4 py-2 sm:py-3 text-sm sm:text-base border-2 border-gray-200 rounded-lg bg-gray-50"/>
                            </div>
                        </div>
                    </div>
<!-- Observação -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fas fa-sticky-note mr-2 text-custom-purple"></i>Observações
                        </label>
                        <textarea id="observacao" rows="3" sm:rows="4" class="w-full px-3 sm:px-4 py-2 sm:py-3 text-sm sm:text-base border-2 border-gray-200 rounded-lg focus:border-purple-500 focus:ring focus:ring-purple-200 transition-all resize-none" placeholder="Informações adicionais sobre o agendamento..."></textarea>
                    </div>

                    <!-- Status (hidden field, default: agendado) -->
                    <input type="hidden" id="status" value="agendado"/>
<div class="flex flex-col sm:flex-row justify-center gap-3 sm:gap-4 pt-6">
                        <button type="submit" class="w-full sm:w-auto px-6 sm:px-8 py-3 bg-purple-600 text-white font-semibold rounded-lg hover:bg-purple-700 transform hover:scale-105 transition-all duration-200 shadow-lg text-sm sm:text-base">
                            <i class="fas fa-save mr-2"></i>Salvar Agendamento
                        </button>
                        <button type="button" onclick="limparFormulario()" class="w-full sm:w-auto px-6 sm:px-8 py-3 bg-gray-600 text-white font-semibold rounded-lg hover:bg-gray-700 transform hover:scale-105 transition-all duration-200 shadow-lg text-sm sm:text-base">
                            <i class="fas fa-eraser mr-2"></i>Limpar
                        </button>
                    </div>
                </form>
            </div>
        </section>
<!-- Dashboard -->
        <section id="dashboard-section" class="section hidden">
            <div class="grid grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-6 mb-6 sm:mb-8"><div class="bg-white p-3 sm:p-4 lg:p-6 rounded-lg sm:rounded-xl shadow-lg hover-scale">
                    <div class="flex items-center justify-between">
                        <div class="min-w-0 flex-1">
                            <p class="text-xs sm:text-sm font-medium text-gray-600 truncate">Total Agendamentos</p>
                            <p class="text-lg sm:text-2xl lg:text-3xl font-bold text-gray-900" id="total-agendamentos">0</p>
                        </div>
                        <div class="p-2 sm:p-3 bg-blue-100 rounded-full flex-shrink-0 ml-2">
                            <i class="fas fa-calendar-alt text-blue-600 text-sm sm:text-lg lg:text-xl"></i>
                        </div>
                    </div>
                </div>
                <div class="bg-white p-3 sm:p-4 lg:p-6 rounded-lg sm:rounded-xl shadow-lg hover-scale">
                    <div class="flex items-center justify-between">
                        <div class="min-w-0 flex-1">
                            <p class="text-xs sm:text-sm font-medium text-gray-600 truncate">Agendados</p>
                            <p class="text-lg sm:text-2xl lg:text-3xl font-bold text-yellow-600" id="total-agendados">0</p>
                        </div>
                        <div class="p-2 sm:p-3 bg-yellow-100 rounded-full flex-shrink-0 ml-2">
                            <i class="fas fa-clock text-yellow-600 text-sm sm:text-lg lg:text-xl"></i>
                        </div>
                    </div>
                </div>
                <div class="bg-white p-3 sm:p-4 lg:p-6 rounded-lg sm:rounded-xl shadow-lg hover-scale">
                    <div class="flex items-center justify-between">
                        <div class="min-w-0 flex-1">
                            <p class="text-xs sm:text-sm font-medium text-gray-600 truncate">Finalizados</p>
                            <p class="text-lg sm:text-2xl lg:text-3xl font-bold text-green-600" id="total-finalizados">0</p>
                        </div>
                        <div class="p-2 sm:p-3 bg-green-100 rounded-full flex-shrink-0 ml-2">
                            <i class="fas fa-check-circle text-green-600 text-sm sm:text-lg lg:text-xl"></i>
                        </div>
                    </div>
                </div>
                <div class="bg-white p-3 sm:p-4 lg:p-6 rounded-lg sm:rounded-xl shadow-lg hover-scale">
                    <div class="flex items-center justify-between">
                        <div class="min-w-0 flex-1">
                            <p class="text-xs sm:text-sm font-medium text-gray-600 truncate">Cancelados</p>
                            <p class="text-lg sm:text-2xl lg:text-3xl font-bold text-red-600" id="total-cancelados">0</p>
                        </div>
                        <div class="p-2 sm:p-3 bg-red-100 rounded-full flex-shrink-0 ml-2">
                            <i class="fas fa-times-circle text-red-600 text-sm sm:text-lg lg:text-xl"></i>
                        </div>
                    </div>
                </div>
            </div>
<!-- Gráfico -->
            <div class="bg-white p-4 sm:p-6 rounded-lg sm:rounded-xl shadow-lg">
                <h3 class="text-lg sm:text-xl font-bold text-gray-800 mb-4">Agendamentos por Status</h3>
                <div class="relative h-64 sm:h-80">
                    <canvas id="statusChart" class="w-full h-full"></canvas>
                </div>
            </div>
        </section>
<!-- Lista de Agendamentos -->
        <section id="list-section" class="section hidden">
            <div class="bg-white rounded-xl sm:rounded-2xl shadow-xl p-4 sm:p-6 lg:p-8">
                <h2 class="text-xl sm:text-2xl lg:text-3xl font-bold text-gray-800 mb-4 sm:mb-6">
                    <i class="fas fa-list mr-2 sm:mr-3 text-custom-purple"></i>
                    <span class="block sm:inline">Gerenciar Agendamentos</span>
                </h2>
<!-- Filtros -->
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4 mb-4 sm:mb-6 p-3 sm:p-4 bg-gray-50 rounded-lg"><div class="sm:col-span-2 lg:col-span-1">
                        <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-2">Buscar por nome:</label>
                        <input type="text" id="filtro-nome" placeholder="Nome do cliente" onkeyup="filtrarAgendamentos()" class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:border-purple-500 focus:ring focus:ring-purple-200"/>
                    </div>
                    <div class="sm:col-span-2 lg:col-span-1">
                        <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-2">Buscar por endereço:</label>
                        <input type="text" id="filtro-endereco" placeholder="Endereço" onkeyup="filtrarAgendamentos()" class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:border-purple-500 focus:ring focus:ring-purple-200"/>
                    </div>
                    <div class="sm:col-span-1 lg:col-span-1">
                        <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-2">Status:</label>
                        <select id="filtro-status" onchange="filtrarAgendamentos()" class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:border-purple-500 focus:ring focus:ring-purple-200">
                            <option value="">Todos os status</option>
                            <option value="agendado">Agendado</option>
                            <option value="finalizado">Finalizado</option>
                            <option value="cancelado">Cancelado</option>
                        </select>
                    </div>
                </div>
<!-- Tabela responsiva -->
                <div class="overflow-x-auto -mx-4 sm:mx-0">
                    <table class="w-full table-auto min-w-full">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-2 sm:px-4 py-2 sm:py-3 text-left text-xs sm:text-sm font-semibold text-gray-600">Cliente</th>
                                <th class="px-2 sm:px-4 py-2 sm:py-3 text-left text-xs sm:text-sm font-semibold text-gray-600 hidden sm:table-cell">Data/Hora</th>
                                <th class="px-2 sm:px-4 py-2 sm:py-3 text-left text-xs sm:text-sm font-semibold text-gray-600 hidden md:table-cell">Endereço</th>
                                <th class="px-2 sm:px-4 py-2 sm:py-3 text-left text-xs sm:text-sm font-semibold text-gray-600 hidden lg:table-cell">Loja</th>
                                <th class="px-2 sm:px-4 py-2 sm:py-3 text-left text-xs sm:text-sm font-semibold text-gray-600">Status</th>
                                <th class="px-2 sm:px-4 py-2 sm:py-3 text-center text-xs sm:text-sm font-semibold text-gray-600">Ações</th>
                            </tr>
                        </thead>
                        <tbody id="agendamentos-list" class="divide-y divide-gray-200">
                            <!-- Conteúdo será inserido via JavaScript -->
                        </tbody>
                    </table>
                </div>
<!-- Mensagem quando não há agendamentos -->
                <div id="no-agendamentos" class="text-center py-6 sm:py-8 hidden">
                    <i class="fas fa-calendar-times text-2xl sm:text-4xl text-gray-400 mb-3 sm:mb-4"></i>
                    <p class="text-sm sm:text-base text-gray-500">Nenhum agendamento encontrado</p>
                </div>
            </div>
        </section>
    </div>
<!-- Modal para edição -->
    <div id="edit-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-lg sm:rounded-xl p-4 sm:p-6 w-full max-w-sm sm:max-w-md mx-4"><h3 class="text-lg sm:text-xl font-bold text-gray-800 mb-4">Editar Agendamento</h3>
            <form id="edit-form">
                <input type="hidden" id="edit-id"/>
                <div class="space-y-4"><div>
                        <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-2">Nome do Cliente</label>
                        <input type="text" id="edit-nome" class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg"/>
                    </div>
                    <div>
                        <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-2">Status</label>
                        <select id="edit-status" class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg">
                            <option value="agendado">Agendado</option>
                            <option value="finalizado">Finalizado</option>
                            <option value="cancelado">Cancelado</option>
                        </select>
                    </div>
                </div><div class="flex flex-col sm:flex-row justify-end gap-2 sm:gap-3 mt-6">
                    <button type="button" onclick="closeEditModal()" class="w-full sm:w-auto px-4 py-2 text-sm bg-gray-500 text-white rounded-lg hover:bg-gray-600 order-2 sm:order-1">
                        Cancelar
                    </button>
                    <button type="submit" class="w-full sm:w-auto px-4 py-2 text-sm bg-purple-600 text-white rounded-lg hover:bg-purple-700 order-1 sm:order-2">
                        Salvar
                    </button>
                </div>
            </form>
        </div>
    </div>
<!-- Toast de notificação -->
    <div id="toast" class="fixed top-4 right-4 left-4 sm:left-auto bg-green-500 text-white px-4 sm:px-6 py-2 sm:py-3 rounded-lg shadow-lg transform translate-x-full transition-transform duration-300 z-50 max-w-sm mx-auto sm:mx-0"><div class="flex items-center justify-center sm:justify-start">
            <i class="fas fa-check-circle mr-2 flex-shrink-0"></i>
            <span id="toast-message" class="text-sm sm:text-base text-center sm:text-left"></span>
        </div>
    </div>

    <script>
        // Dados globais
        let agendamentos = JSON.parse(localStorage.getItem('agendamentos')) || [];
        let editingId = null;
        let statusChart = null;

        // Ambientes por tipo de imóvel
        const ambientesPorTipo = {
            casa: [
                'Sala de Estar',
                'Sala de Jantar',
                'Cozinha',
                'Dormitório Casal',
                'Dormitório Solteiro',
                'Banheiro Social',
                'Banheiro Suíte',
                'Área de Serviço',
                'Escritório',
                'Área Gourmet',
                'Garagem',
                'Quintal',
                'Varanda',
                'Despensa',
                'Closet'
            ],
            apartamento: [
                'Sala de Estar',
                'Sala de Jantar',
                'Cozinha',
                'Dormitório Casal',
                'Dormitório Solteiro',
                'Banheiro Social',
                'Banheiro Suíte',
                'Área de Serviço',
                'Escritório',
                'Varanda',
                'Sacada',
                'Closet',
                'Área Gourmet'
            ]
        };

        // Inicialização
        document.addEventListener('DOMContentLoaded', function() {
            showSection('form');
            updateDashboard();
            renderAgendamentos();
            
            // Define data mínima como hoje
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('data').setAttribute('min', today);

            // Event listeners
            document.getElementById('agendamento-form').addEventListener('submit', salvarAgendamento);
            document.getElementById('edit-form').addEventListener('submit', updateAgendamento);
        });

        // Navegação entre seções
        function showSection(section) {
            document.querySelectorAll('.section').forEach(s => s.classList.add('hidden'));
            document.getElementById(section + '-section').classList.remove('hidden');
            
            if (section === 'dashboard') {
                updateDashboard();
                renderChart();
            } else if (section === 'list') {
                renderAgendamentos();
            }
        }

        // Atualizar ambientes baseado no tipo de imóvel
        function updateAmbientes() {
            const tipoImovel = document.getElementById('tipo-imovel').value;
            const ambienteSelect = document.getElementById('ambiente');
            
            ambienteSelect.innerHTML = '<option value="">Selecione o ambiente</option>';
            
            if (tipoImovel && ambientesPorTipo[tipoImovel]) {
                ambientesPorTipo[tipoImovel].forEach(ambiente => {
                    const option = document.createElement('option');
                    option.value = ambiente;
                    option.textContent = ambiente;
                    ambienteSelect.appendChild(option);
                });
            }
        }

        // Buscar endereço por CEP
        async function buscarEndereco() {
            const cep = document.getElementById('cep').value.replace(/\D/g, '');
            
            if (cep.length !== 8) {
                return;
            }

            try {
                const response = await fetch(`https://viacep.com.br/ws/${cep}/json/`);
                const data = await response.json();
                
                if (!data.erro) {
                    document.getElementById('logradouro').value = data.logradouro;
                    document.getElementById('bairro').value = data.bairro;
                    document.getElementById('cidade').value = `${data.localidade} - ${data.uf}`;
                } else {
                    showToast('CEP não encontrado', 'error');
                }
            } catch (error) {
                showToast('Erro ao buscar CEP', 'error');
            }
        }

        // Salvar agendamento
        function salvarAgendamento(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const agendamento = {
                id: Date.now(),
                nomeCliente: document.getElementById('nome-cliente').value,
                telefone: document.getElementById('telefone').value,
                email: document.getElementById('email').value,
                tipoImovel: document.getElementById('tipo-imovel').value,
                ambiente: document.getElementById('ambiente').value,
                loja: document.getElementById('loja').value,
                data: document.getElementById('data').value,
                horario: document.getElementById('horario').value,
                cep: document.getElementById('cep').value,
                numero: document.getElementById('numero').value,
                complemento: document.getElementById('complemento').value,
                logradouro: document.getElementById('logradouro').value,
                bairro: document.getElementById('bairro').value,
                cidade: document.getElementById('cidade').value,
                observacao: document.getElementById('observacao').value,
                status: 'agendado',
                criadoEm: new Date().toISOString()
            };

            agendamentos.push(agendamento);
            localStorage.setItem('agendamentos', JSON.stringify(agendamentos));
            
            showToast('Agendamento salvo com sucesso!');
            limparFormulario();
            updateDashboard();
        }

        // Limpar formulário
        function limparFormulario() {
            document.getElementById('agendamento-form').reset();
            document.getElementById('ambiente').innerHTML = '<option value="">Primeiro selecione o tipo de imóvel</option>';
        }
// Renderizar lista de agendamentos
        function renderAgendamentos() {
            const tbody = document.getElementById('agendamentos-list');
            const noAgendamentos = document.getElementById('no-agendamentos');
            
            let filteredAgendamentos = [...agendamentos];
            
            // Aplicar filtros
            const filtroNome = document.getElementById('filtro-nome')?.value.toLowerCase() || '';
            const filtroEndereco = document.getElementById('filtro-endereco')?.value.toLowerCase() || '';
            const filtroStatus = document.getElementById('filtro-status')?.value || '';
            
            filteredAgendamentos = filteredAgendamentos.filter(agendamento => {
                const matchNome = agendamento.nomeCliente.toLowerCase().includes(filtroNome);
                const matchEndereco = `${agendamento.logradouro} ${agendamento.bairro} ${agendamento.cidade}`.toLowerCase().includes(filtroEndereco);
                const matchStatus = !filtroStatus || agendamento.status === filtroStatus;
                
                return matchNome && matchEndereco && matchStatus;
            });
            
            if (filteredAgendamentos.length === 0) {
                tbody.innerHTML = '';
                noAgendamentos.classList.remove('hidden');
                return;
            }
            
            noAgendamentos.classList.add('hidden');
            
            tbody.innerHTML = filteredAgendamentos.map(agendamento => `
                <tr class="hover:bg-gray-50">
                    <td class="px-2 sm:px-4 py-2 sm:py-3">
                        <div>
                            <div class="font-medium text-gray-900 text-sm">${agendamento.nomeCliente}</div>
                            <div class="text-xs text-gray-500 sm:hidden">${formatDate(agendamento.data)} ${agendamento.horario}</div>
                            <div class="text-xs text-gray-500">${agendamento.telefone}</div>
                        </div>
                    </td>
                    <td class="px-2 sm:px-4 py-2 sm:py-3 hidden sm:table-cell">
                        <div class="text-sm text-gray-900">${formatDate(agendamento.data)}</div>
                        <div class="text-xs text-gray-500">${agendamento.horario}</div>
                    </td>
                    <td class="px-2 sm:px-4 py-2 sm:py-3 hidden md:table-cell">
                        <div class="text-xs text-gray-900">${agendamento.logradouro}, ${agendamento.numero}</div>
                        <div class="text-xs text-gray-500">${agendamento.bairro}</div>
                    </td>
                    <td class="px-2 sm:px-4 py-2 sm:py-3 hidden lg:table-cell">
                        <div class="text-xs text-gray-900">${agendamento.loja}</div>
                        <div class="text-xs text-gray-500">${agendamento.ambiente}</div>
                    </td>
                    <td class="px-2 sm:px-4 py-2 sm:py-3">
                        <span class="px-2 py-1 text-xs font-medium rounded-full ${getStatusColor(agendamento.status)}">
                            ${getStatusText(agendamento.status)}
                        </span>
                    </td>
                    <td class="px-2 sm:px-4 py-2 sm:py-3 text-center">
                        <div class="flex justify-center space-x-1 sm:space-x-2">
                            <button onclick="editAgendamento(${agendamento.id})" 
                                    class="text-blue-600 hover:text-blue-800 p-1">
                                <i class="fas fa-edit text-sm"></i>
                            </button>
                            <button onclick="deleteAgendamento(${agendamento.id})" 
                                    class="text-red-600 hover:text-red-800 p-1">
                                <i class="fas fa-trash text-sm"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        // Função para toggle do menu mobile
        function toggleMobileMenu() {
            const mobileMenu = document.getElementById('mobile-menu');
            const icon = document.getElementById('mobile-menu-icon');
            
            if (mobileMenu.classList.contains('hidden')) {
                mobileMenu.classList.remove('hidden');
                icon.classList.remove('fa-bars');
                icon.classList.add('fa-times');
            } else {
                mobileMenu.classList.add('hidden');
                icon.classList.remove('fa-times');
                icon.classList.add('fa-bars');
            }
        }

        // Filtrar agendamentos
        function filtrarAgendamentos() {
            renderAgendamentos();
        }

        // Editar agendamento
        function editAgendamento(id) {
            const agendamento = agendamentos.find(a => a.id === id);
            if (!agendamento) return;
            
            editingId = id;
            document.getElementById('edit-id').value = id;
            document.getElementById('edit-nome').value = agendamento.nomeCliente;
            document.getElementById('edit-status').value = agendamento.status;
            
            document.getElementById('edit-modal').classList.remove('hidden');
        }

        // Atualizar agendamento
        function updateAgendamento(e) {
            e.preventDefault();
            
            const id = parseInt(document.getElementById('edit-id').value);
            const agendamentoIndex = agendamentos.findIndex(a => a.id === id);
            
            if (agendamentoIndex !== -1) {
                agendamentos[agendamentoIndex].nomeCliente = document.getElementById('edit-nome').value;
                agendamentos[agendamentoIndex].status = document.getElementById('edit-status').value;
                
                localStorage.setItem('agendamentos', JSON.stringify(agendamentos));
                
                showToast('Agendamento atualizado com sucesso!');
                closeEditModal();
                renderAgendamentos();
                updateDashboard();
            }
        }

        // Fechar modal de edição
        function closeEditModal() {
            document.getElementById('edit-modal').classList.add('hidden');
            editingId = null;
        }

        // Excluir agendamento
        function deleteAgendamento(id) {
            if (confirm('Tem certeza que deseja excluir este agendamento?')) {
                agendamentos = agendamentos.filter(a => a.id !== id);
                localStorage.setItem('agendamentos', JSON.stringify(agendamentos));
                
                showToast('Agendamento excluído com sucesso!');
                renderAgendamentos();
                updateDashboard();
            }
        }

        // Atualizar dashboard
        function updateDashboard() {
            const total = agendamentos.length;
            const agendados = agendamentos.filter(a => a.status === 'agendado').length;
            const finalizados = agendamentos.filter(a => a.status === 'finalizado').length;
            const cancelados = agendamentos.filter(a => a.status === 'cancelado').length;
            
            document.getElementById('total-agendamentos').textContent = total;
            document.getElementById('total-agendados').textContent = agendados;
            document.getElementById('total-finalizados').textContent = finalizados;
            document.getElementById('total-cancelados').textContent = cancelados;
        }

        // Renderizar gráfico
        function renderChart() {
            const ctx = document.getElementById('statusChart').getContext('2d');
            
            if (statusChart) {
                statusChart.destroy();
            }
            
            const agendados = agendamentos.filter(a => a.status === 'agendado').length;
            const finalizados = agendamentos.filter(a => a.status === 'finalizado').length;
            const cancelados = agendamentos.filter(a => a.status === 'cancelado').length;
            
            statusChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Agendados', 'Finalizados', 'Cancelados'],
                    datasets: [{
                        data: [agendados, finalizados, cancelados],
                        backgroundColor: ['#F59E0B', '#10B981', '#EF4444'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        // Funções auxiliares
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('pt-BR');
        }

        function getStatusColor(status) {
            switch (status) {
                case 'agendado': return 'bg-yellow-100 text-yellow-800';
                case 'finalizado': return 'bg-green-100 text-green-800';
                case 'cancelado': return 'bg-red-100 text-red-800';
                default: return 'bg-gray-100 text-gray-800';
            }
        }

        function getStatusText(status) {
            switch (status) {
                case 'agendado': return 'Agendado';
                case 'finalizado': return 'Finalizado';
                case 'cancelado': return 'Cancelado';
                default: return status;
            }
        }

        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toast-message');
            
            toastMessage.textContent = message;
            
            if (type === 'error') {
                toast.className = toast.className.replace('bg-green-500', 'bg-red-500');
            } else {
                toast.className = toast.className.replace('bg-red-500', 'bg-green-500');
            }
            
            toast.classList.remove('translate-x-full');
            
            setTimeout(() => {
                toast.classList.add('translate-x-full');
            }, 3000);
        }

        // Máscara para telefone
        document.getElementById('telefone').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            value = value.replace(/(\d{2})(\d)/, '($1) $2');
            value = value.replace(/(\d{5})(\d)/, '$1-$2');
            e.target.value = value;
        });

        // Máscara para CEP
        document.getElementById('cep').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            value = value.replace(/(\d{5})(\d)/, '$1-$2');
            e.target.value = value;
        });

        // Fechar modal ao clicar fora
        document.getElementById('edit-modal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeEditModal();
            }
        });

        // Função para exportar dados (simulação de backend)
        function exportarDados() {
            const dataStr = JSON.stringify(agendamentos, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'agendamentos.json';
            link.click();
        }

        // Simular sincronização com servidor
        function sincronizarDados() {
            showToast('Dados sincronizados com sucesso!');
            console.log('Simulando sincronização com backend:', agendamentos);
        }
    </script>

</body></html>
